import Keys from './snippets/keys.mdx'

# `wallet_verifySignature`

Verifies a signature from a key associated with an account.

The validity of the signature is returned along with a proof that can be executed using e.g. `eth_call`.

:::note
It is only possible to validate signatures for admin keys.
:::

<Keys />

## Request

```ts
type Request = {
  method: 'wallet_verifySignature',
  params: [{
    /** Account address */
    address: `0x${string}`,
    /** Chain ID of the account with the given key configured */
    chainId: number,
    /** Digest of the message to verify */
    digest: `0x${string}`,
    /** Signature to verify */
    signature: `0x${string}`,
  }],
}
```

## Response

```ts
type Response = {
  /** Whether the signature is valid */
  valid: boolean,
  /** Proof that can be used to verify the signature */
  proof?: {
    /** Address of an account (either delegated or stored) that the signature was verified against */
    account: `0x${string}`,
    /** The key hash that signed the digest */
    keyHash: `0x${string}`,
    /** Initialization precall. Provided if account is a stored account which has not been delegated */
    initPreCall?: {
      calls: {
        data?: `0x${string}`,
        to: `0x${string}`,
        value?: bigint,
      }[],
      capabilities: object,
      from: `0x${string}`,
    } | null,
  } | null,
}
```

## Verification

Signature is always verified against an account (either deployed or stored in RPC storage).
`account` contains the account address the signature was verified against.

To verify that provided account is indeed tied to the provided `keyId`, user can either

1. Query the `AccountRegistry` contract.
2. Verify the returned `idSignature`. It is only returned for accounts that are not yet delegated.

To verify that the signature is valid for the returned account, user can call
`unwrapAndValidateSignature` on the returned account.

## Example

```sh
cast rpc --rpc-url https://rpc.ithaca.xyz wallet_verifySignature '[{"address": "0x1234567890123456789012345678901234567890", "chainId": 8453, "digest": "0xabcd", "signature": "0x1234"}]'
```

```json
{
  "valid": true,
  "proof": {
    "account": "0x1234567890123456789012345678901234567890",
    "keyHash": "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
    "initPreCall": null
  }
}
```
