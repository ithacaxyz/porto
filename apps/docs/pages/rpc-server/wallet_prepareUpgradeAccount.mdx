import Keys from './snippets/keys.mdx'

# `wallet_prepareUpgradeAccount`

Prepares an Externally-Owned Account (EOA) to be upgraded into a Porto Account. 

The returned `authorization` object and `digest` must be signed by the EOA root key, 
and forwarded to [`wallet_upgradeAccount`](/rpc-server/wallet_upgradeAccount).

:::tip
This method is intended to be used in conjunction with [`wallet_upgradeAccount`](/rpc-server/wallet_upgradeAccount).
:::

<Keys />

## Request

```ts
type Request = {
  method: 'wallet_prepareUpgradeAccount',
  params: [{
    // Address of the EOA to upgrade.
    address: `0x${string}`,
    // Optional chain ID to upgrade on. If not specified, the RPC
    // Server will handle what chain to upgrade on. This chain will
    // be the "source"/"home" chain of the account.
    chainId?: `0x${string}`,
    // Address of the account contract to delegate to.
    delegation: `0x${string}`,
    // Additional capabilities.
    capabilities: {
      authorizeKeys: {
        // See "Keys"
        key: {
          expiry?: number,
          type: 'p256' | 'webauthnp256' | 'secp256k1',
          role: 'admin' | 'normal' | 'session',
          publicKey: `0x${string}`,
        },
        permissions: ({
          type: 'call',
          // See "Selectors"
          selector: string,
          to: `0x${string}`,
        } | {
          type: 'spend',
          limit: number,
          period: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year',
          // defaults to the native token (address zero)
          token?: `0x${string}`,
        })[],
      }[],
    },
  }],
}
```

## Response

```ts
type Response = {
  // Chain ID of the account.
  chainId: `0x${string}`,
  // Context that includes the prepared pre-call. 
  context: {
    // Unsigned authorization object to be signed by the EOA root key.
    authorization: {
      // Contract address to delegate to.
      address: `0x${string}`,
      // Permitted chain ID. 
      // Note: `0x0` allows for replayability across chains.
      chainId: `0x${string}`,
      // Permitted nonce.
      nonce: `0x${string}`,
    },
    // Unsigned pre-call to be signed by the EOA root key.
    preCall: {
      eoa: `0x${string}`,
      executionData: `0x${string}`,
      nonce: `0x${string}`,
      signature: `0x${string}`,
    },
  },
  // Tuple of digests to be signed by the EOA root key. Includes the
  // authorization digest and the pre-call digest.
  digest: [authDigest: `0x${string}`, preCallDigest: `0x${string}`],
  // EIP-712 typed data of the precall. This can be used to rebuild (and verify)
  // the provided digest.
  typedData: any,
  // Capabilities assigned to the account.
  capabilities: {
    authorizeKeys: {
      // key hash
      hash: `0x${string}`,
      // See "Keys"
      key: {
        expiry?: number,
        type: 'p256' | 'webauthnp256' | 'secp256k1',
        role: 'admin' | 'normal' | 'session',
        publicKey: `0x${string}`,
      },
      permissions: ({
        type: 'call',
        // See "Selectors"
        selector: string,
        to: `0x${string}`,
      } | {
        type: 'spend',
        limit: number,
        period: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year',
        // defaults to the native token (address zero)
        token?: `0x${string}`,
      })[],
    }[],
    // Key revocations.
    revokeKeys: {
      hash: `0x${string}`,
      id?: `0x${string}`
    }[],
  }
}
```
