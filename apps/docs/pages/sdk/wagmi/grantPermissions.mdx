# `grantPermissions`

VanillaJS action for granting permissions to an application. Uses [`experimental_grantPermissions`](/sdk/rpc/experimental_grantPermissions) under the hood.

## Usage

```ts
import { Actions } from 'porto/wagmi'
import { porto } from 'porto/wagmi'
import { createConfig, http } from 'wagmi'
import { baseSepolia } from 'wagmi/chains'

export const config = createConfig({
  chains: [baseSepolia],
  connectors: [porto()],
  transports: {
    [baseSepolia.id]: http(),
  },
})

const token = '0x29f45fc3ed1d0ffafb5e2af9cc6c3ab1555cd5a2'

const permission = await Actions.grantPermissions(config, {
  expiry: Math.floor(Date.now() / 1_000) + 60 * 60, // 1 hour
  permissions: {
    calls: [{
      signature: 'transfer(address,uint256)',
      to: token
    }],
    spend: [{
      limit: toHex(parseEther('50')), // 50 EXP
      period: 'day',
      token: token,
    }]
  },
})

console.log(permission.id) // '0x...'
```

## Parameters

```ts
type Parameters = {
  /** Chain ID to grant permissions on */
  chainId?: number

  /** The connector to use */
  connector?: Connector

  /** Address of the account to grant permissions on.
   * Defaults to the current account.
   */
  address?: `0x${string}`

  /** Expiry of the permissions */
  expiry: number

  /** Key to grant permissions to. Defaults to a wallet-managed key. */
  key?: {
    /** Public key. Accepts an address for `address` & `secp256k1` types. */
    publicKey?: `0x${string}`
    /** Key type. */
    type?: 'address' | 'p256' | 'secp256k1' | 'webauthn-p256'
  }

  /** Permissions to grant */
  permissions: {
    /** Call permissions */
    calls: {
      /** Function signature or 4-byte signature */
      signature?: string
      /** Authorized target address */
      to?: `0x${string}`
    }[]

    /** Spend permissions */
    spend: {
      /** Spending limit (in wei) per period */
      limit: `0x${string}`
      /** Period of the spend limit */
      period: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year'
      /** ERC20 token to set the limit on (defaults to native token) */
      token?: `0x${string}`
    }[]
  }
}
```

## Return Value

```ts
type ReturnType = {
  /** Address of the account */
  address: `0x${string}`

  /** Chain ID */
  chainId: `0x${string}`

  /** Expiry timestamp */
  expiry: number

  /** Permission ID */
  id: `0x${string}`

  /** Key information */
  key: {
    /** Public key */
    publicKey: `0x${string}`
    /** Key type */
    type: 'address' | 'p256' | 'secp256k1' | 'webauthn-p256'
  }

  /** Granted permissions */
  permissions: {
    /** Call permissions */
    calls: {
      signature?: string
      to?: `0x${string}`
    }[]

    /** Spend permissions */
    spend: {
      limit: `0x${string}`
      period: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year'
      token?: `0x${string}`
    }[]
  }
}
```

## Example with App-managed Keys

Applications can also grant permissions to a specific signing key by providing the `key` parameter.

```ts
import { Actions } from 'porto/wagmi'
import { porto } from 'porto/wagmi'
import { createConfig, http } from 'wagmi'
import { baseSepolia } from 'wagmi/chains'

export const config = createConfig({
  chains: [baseSepolia],
  connectors: [porto()],
  transports: {
    [baseSepolia.id]: http(),
  },
})

const token = '0x29f45fc3ed1d0ffafb5e2af9cc6c3ab1555cd5a2'
const account = privateKeyToAccount('0x...') // [!code focus]

// Grant permissions with custom key
const permission = await Actions.grantPermissions(config, {
  expiry: Math.floor(Date.now() / 1000) + 7 * 24 * 60 * 60, // 1 week
  key: { // [!code focus]
    publicKey: account.address, // [!code focus]
    type: 'secp256k1', // [!code focus]
  }, // [!code focus]
  permissions: {
    calls: [{
      signature: 'transfer(address,uint256)',
      to: token
    }],
    spend: [{
      limit: toHex(parseEther('50')), // 50 EXP
      period: 'day',
      token: token,
    }]
  },
})
```