import { TryItOut } from '../../../components/TryItOut'
import { parseEther, toHex } from 'viem'

# `useConnect`

React hook for connecting an account. Uses [`wallet_connect`](/sdk/rpc/wallet_connect) under the hood.

<TryItOut
  exampleSlug="#example"
  fn={async ({ provider }) => {
    const accounts = await provider.request({
      method: 'wallet_connect',
    })

    return accounts
  }}
  requireConnection={false}
  transformResultCode={(code) => {
    return 'const response = ' + code
  }}
/>

## Example

```tsx twoslash
import { Porto } from 'porto'
import * as React from 'react'
import { Hooks } from 'porto/wagmi'
import { injected } from 'wagmi/connectors'

const porto = Porto.create()

const connector = injected({
  target: () => ({
    id: 'porto',
    name: 'Porto',
    provider: porto.provider as never,
  }),
})

export function App() {
  const connect = Hooks.useConnect()

  return (
    <button onClick={() => connect.mutate({ connector })}>Connect</button>
  )
}
```

<TryItOut
  fn={async ({ provider }) => {
    const accounts = await provider.request({
      method: 'wallet_connect',
    })

    return accounts
  }}
  requireConnection={false}
  transformResultCode={(code) => {
    return 'const response = ' + code
  }}
/>

### Create Account

Passing `createAccount: true{:ts}` will prompt the user to create a new account (ie. "sign up").

```ts twoslash
import { Porto } from 'porto'

const { provider } = Porto.create()
// ---cut---
const response = await provider.request({
  method: 'wallet_connect',
  params: [{
    capabilities: {
      createAccount: true,
    },
  }],
})
```

<TryItOut
  fn={async ({ provider }) => {
    const response = await provider.request({
      method: 'wallet_connect',
      params: [{
        capabilities: {
          createAccount: true,
        },
      }],
    })

    return response
  }}
  requireConnection={false}
  transformResultCode={(code) => {
    return 'const response = ' + code
  }}
/>

### Grant Permissions

You can grant permissions for an Application to perform actions on behalf of the account
by providing the `grantPermissions` capability with a value.

In the example below, the Application is granted permission to perform `transfer` calls on the EXP ERC20 contract,
with a spending limit of up to `50 EXP` per minute.

```ts twoslash
import { Porto } from 'porto'

const { provider } = Porto.create()
// ---cut---
import { parseEther, toHex } from 'viem'

const token = '0x706aa5c8e5cc2c67da21ee220718f6f6b154e75c'

const response = await provider.request({
  method: 'wallet_connect',
  params: [{
    capabilities: {
      grantPermissions: {
        expiry: Math.floor(Date.now() / 1000) + 60 * 60, // 1 hour
        permissions: {
          calls: [{
            signature: 'transfer(address,uint256)',
            to: token,
          }],
          spend: [{
            limit: toHex(parseEther('50')), // 50 EXP
            period: 'minute',
            token: token,
          }],
        },
      },
    },
  }],
})
```

<TryItOut
  fn={async ({ provider }) => {
    const token = '0x706aa5c8e5cc2c67da21ee220718f6f6b154e75c'

    const response = await provider.request({
      method: 'wallet_connect',
      params: [{
        capabilities: {
          grantPermissions: {
            expiry: Math.floor(Date.now() / 1000) + 60 * 60, // 1 hour
            permissions: {
              calls: [{ to: token }],
              spend: [{
                limit: toHex(parseEther('50')), // 50 EXP
                period: 'minute',
                token: token,
              }],
            },
          },
        },
      }]
    })

    return response
  }}
  requireConnection={false}
  transformResultCode={(code) => {
    return 'const response = ' + code
  }}
/>
