import { Example } from '../../../components/guides/Payments'

# Payments

## Example

Feel free to check out the example before moving on.

<div className="flex justify-center items-center bg-gray3/50 h-[300px] rounded-xl">
  <Example />
</div>

## Steps

::::steps

### Connect Account

Follow the [Onboard & Discover Accounts](/sdk/guides/discover-accounts) guide to get this set up.

### Create a new component

Create your `BuyNow` component that will contain the logic for the payment.

```tsx twoslash [BuyNow.tsx]
import * as React from 'react'

export function BuyNow() {
  return (
    <form>
      <button type="submit">Buy Now</button>
    </form>
  )
}
```

### Add a form handler

```tsx [BuyNow.tsx]
import * as React from 'react'

export function BuyNow() {
  async function submit(event: React.FormEvent<HTMLFormElement>) { // [!code ++]
    event.preventDefault() // [!code ++]
  }

  return (
    <form> {/* [!code --] */}
    <form onSubmit={submit}> {/* [!code ++] */}
      <button type="submit">Buy Now</button>
    </form>
  )
}
```

### Hook up a [`useSendCalls`](https://wagmi.sh/react/api/hooks/useSendCalls) hook

Now that we have the form handler,
we can hook up the [`useSendCalls`](https://wagmi.sh/react/api/hooks/useSendCalls) hook to submit a batch of calls.

:::code-group

```tsx [BuyNow.tsx]
import * as React from 'react'
import { exp1Config, expNftConfig } from './abi' // [!code ++]
import { useSendCalls } from 'wagmi' // [!code ++]
import { Value } from 'ox' // [!code ++]

export function BuyNow() {
  const { data, isPending, sendCalls } = useSendCalls() // [!code ++]

  async function submit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault()

    sendCalls({ // [!code ++]
      calls: [ // [!code ++]
        { // [!code ++]
          abi: exp1Config.abi, // [!code ++]
          args: [expNftConfig.address[84532], Value.fromEther('10')], // [!code ++]
          functionName: 'approve', // [!code ++]
          to: exp1Config.address[84532] // [!code ++]
        }, // [!code ++]
        { // [!code ++]
          abi: expNftConfig.abi, // [!code ++]
          functionName: 'mint', // [!code ++]
          to: expNftConfig.address[84532] // [!code ++]
        } // [!code ++]
      ] // [!code ++]
    }) // [!code ++]
  }

  return (
    <form onSubmit={submit}>
      <button type="submit">Buy Now</button>
    </form>
  )
}
```

```ts twoslash [abi.ts] filename="abi.ts"
// [!include ~/snippets/abi.ts]
```

:::

### Hook up [`useWaitForCallsStatus`](https://wagmi.sh/react/api/hooks/useWaitForCallsStatus) and add a loading state

Now that we have the calls submitted, we can hook up the [`useWaitForCallsStatus`](https://wagmi.sh/react/api/hooks/useWaitForCallsStatus) hook to wait for the calls to be confirmed.

:::code-group

```tsx [BuyNow.tsx]
import * as React from 'react'
import { exp1Config, expNftConfig } from './abi'
import { useSendCalls } from 'wagmi' // [!code --]
import { useSendCalls, useWaitForCallsStatus } from 'wagmi' // [!code ++]
import { Value } from 'ox'

export function BuyNow() {
  const { data, isPending, sendCalls } = useSendCalls()

  const { error, isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForCallsStatus({  // [!code ++]
    id: data?.id,  // [!code ++]
    pollingInterval: 800,  // [!code ++]
  })  // [!code ++]

  async function submit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault()

    sendCalls({
      calls: [
        {
          abi: exp1Config.abi,
          args: [expNftConfig.address[84532], Value.fromEther('10')],
          functionName: 'approve',
          to: exp1Config.address[84532]
        },
        {
          abi: expNftConfig.abi,
          functionName: 'mint',
          to: expNftConfig.address[84532]
        }
      ]
    })
  }

  return (
    <form onSubmit={submit}>
      <button type="submit">
        {isPending ? ( {/*  [!code ++] */}
          <> {/*  [!code ++] */}
            Check prompt {/*  [!code ++] */}
          </> {/*  [!code ++] */}
        ) : isConfirming ? ( {/*  [!code ++] */}
          'Completing purchase' {/*  [!code ++] */}
        ) : ( {/*  [!code ++] */}
          <> {/*  [!code ++] */}
            Buy Now {/*  [!code ++] */}
          </> {/*  [!code ++] */}
        )} {/*  [!code ++] */}
      </button>
    </form>
  )
}
```

```ts twoslash [abi.ts] filename="abi.ts"
// [!include ~/snippets/abi.ts]
```

:::

## Display the NFT on success

```tsx [BuyNow.tsx]
import * as React from 'react'
import { exp1Config, expNftConfig } from './abi'
import { useSendCalls, useWaitForCallsStatus } from 'wagmi'
import { Value } from 'ox'

export function BuyNow() {
  const { data, isPending, sendCalls } = useSendCalls()

  const { error, isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForCallsStatus({
    id: data?.id,
    pollingInterval: 800,
  })

  async function submit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault()

    sendCalls({
      calls: [
        {
          abi: exp1Config.abi,
          args: [expNftConfig.address[84532], Value.fromEther('10')],
          functionName: 'approve',
          to: exp1Config.address[84532]
        },
        {
          abi: expNftConfig.abi,
          functionName: 'mint',
          to: expNftConfig.address[84532]
        }
      ]
    })
  }

  if (isConfirmed)
    return (
      <div className="flex flex-col items-center gap-4">
        <img
          alt="Running Sneaker"
          className="size-[183px] rounded-[13px] object-cover object-accent"
          src="/sneaker.png"
        />
        <div className="-tracking-[2.8%] font-medium text-[15px] text-gray9 leading-normal">
          Purchase complete!
        </div>
      </div>
    )

  return (
    <form onSubmit={submit}>
      <button type="submit">
        {isPending ? (
          <>
            Check prompt
          </>
        ) : isConfirming ? (
          'Completing purchase'
        ) : (
          <>
            Buy Now
          </>
        )}
      </button>
    </form>
  )
}
```

```ts twoslash [abi.ts] filename="abi.ts"
// [!include ~/snippets/abi.ts]
```

:::

## Wire it up

Finally, we can wire up our Mint NFT component to our application's entrypoint.

:::code-group

```tsx [App.tsx] filename="App.tsx"
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { WagmiProvider, useAccount } from 'wagmi'
import { config } from './config'
import { BuyNow } from './BuyNow'

const queryClient = new QueryClient()

function App() {
  return (
    <WagmiProvider config={config}>
      <QueryClientProvider client={queryClient}>
        <BuyNow />
      </QueryClientProvider>
    </WagmiProvider>
  )
}
```

```tsx [BuyNow.tsx] filename="BuyNow.tsx"
import * as React from 'react'
import { exp1Config, expNftConfig } from './abi'
import { useSendCalls, useWaitForCallsStatus } from 'wagmi'
import { Value } from 'ox'

export function BuyNow() {
  const { data, isPending, sendCalls } = useSendCalls()

  const { error, isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForCallsStatus({
    id: data?.id,
    pollingInterval: 800,
  })

  async function submit(event: React.FormEvent<HTMLFormElement>) {
    event.preventDefault()

    sendCalls({
      calls: [
        {
          abi: exp1Config.abi,
          args: [expNftConfig.address[84532], Value.fromEther('10')],
          functionName: 'approve',
          to: exp1Config.address[84532]
        },
        {
          abi: expNftConfig.abi,
          functionName: 'mint',
          to: expNftConfig.address[84532]
        }
      ]
    })
  }

  if (isConfirmed)
    return (
      <div className="flex flex-col items-center gap-4">
        <img
          alt="Running Sneaker"
          className="size-[183px] rounded-[13px] object-cover object-accent"
          src="/sneaker.png"
        />
        <div className="-tracking-[2.8%] font-medium text-[15px] text-gray9 leading-normal">
          Purchase complete!
        </div>
      </div>
    )

  return (
    <form onSubmit={submit}>
      <button type="submit">
        {isPending ? (
          <>
            Check prompt
          </>
        ) : isConfirming ? (
          'Completing purchase'
        ) : (
          <>
            Buy Now
          </>
        )}
      </button>
    </form>
  )
}
```

```ts twoslash [config.ts] filename="config.ts"
// [!include ~/snippets/wagmi/config.ts]
```

```ts twoslash [abi.ts] filename="abi.ts"
// [!include ~/snippets/abi.ts]
```

:::

[See the example](#example).
